<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ninja Boss Battle Gaiden</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: #1a1a2e;
            font-family: 'Courier New', monospace;
            color: #fff;
        }
        #gameCanvas {
            border: 4px solid #16213e;
            background: #0f3460;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .controls {
            margin-top: 20px;
            text-align: center;
            background: #16213e;
            padding: 15px;
            border-radius: 8px;
            max-width: 800px;
        }
        .controls h3 {
            margin: 0 0 10px 0;
            color: #e94560;
        }
        .controls p {
            margin: 5px 0;
            font-size: 14px;
        }
        .stats {
            margin-top: 10px;
            font-size: 18px;
            color: #e94560;
        }
        .title {
            font-size: 32px;
            color: #e94560;
            text-shadow: 2px 2px 4px #000;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="title">‚öîÔ∏è NINJA BOSS BATTLE GAIDEN ‚öîÔ∏è</div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div class="controls">
        <h3>CONTROLS</h3>
        <p>‚Üê ‚Üí Arrow Keys: Move | ‚Üë Jump | Z: Slash | X: Throw Star (Unlimited!)</p>
        <div class="stats">
            <span id="health">Health: 100</span> | 
            <span id="score">Score: 0</span> | 
            <span id="level">Level: 1/10</span>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const game = {
            score: 0,
            running: true,
            keys: {},
            gravity: 0.6,
            projectiles: [],
            platforms: [],
            currentLevel: 1,
            maxLevel: 10,
            boss: null,
            transitioning: false,
            transitionTimer: 0,
            starCooldown: 0
        };

        const player = {
            x: 100,
            y: 400,
            width: 30,
            height: 40,
            velocityX: 0,
            velocityY: 0,
            speed: 5,
            jumpPower: 12,
            onGround: false,
            health: 100,
            maxHealth: 100,
            facing: 1,
            attacking: false,
            attackTimer: 0,
            invincible: false,
            invincibleTimer: 0
        };

        game.platforms = [
            {x: 0, y: 550, width: 800, height: 50},
            {x: 200, y: 450, width: 150, height: 20},
            {x: 450, y: 350, width: 150, height: 20},
            {x: 100, y: 250, width: 150, height: 20},
            {x: 500, y: 200, width: 150, height: 20},
            {x: 650, y: 450, width: 150, height: 20}
        ];

        const bossData = [
            {
                name: "Shadow Ninja",
                health: 100,
                color: '#2d2d2d',
                size: {w: 35, h: 45},
                attackPattern: 'rush',
                speed: 4,
                damage: 10,
                desc: "A swift assassin!"
            },
            {
                name: "Heavy Samurai",
                health: 150,
                color: '#8b4513',
                size: {w: 50, h: 60},
                attackPattern: 'slow_heavy',
                speed: 2,
                damage: 20,
                desc: "Slow but devastating!"
            },
            {
                name: "Dual Blade Assassin",
                health: 120,
                color: '#4b0082',
                size: {w: 40, h: 50},
                attackPattern: 'dual_slash',
                speed: 6,
                damage: 12,
                desc: "Twin blades of fury!"
            },
            {
                name: "Fire Monk",
                health: 130,
                color: '#ff4500',
                size: {w: 45, h: 55},
                attackPattern: 'fire_ranged',
                speed: 3,
                damage: 15,
                desc: "Master of flames!"
            },
            {
                name: "Ice Sorcerer",
                health: 140,
                color: '#00ffff',
                size: {w: 42, h: 52},
                attackPattern: 'ice_projectile',
                speed: 2.5,
                damage: 15,
                desc: "Freeze your enemies!"
            },
            {
                name: "Thunder Warrior",
                health: 160,
                color: '#ffff00',
                size: {w: 48, h: 58},
                attackPattern: 'lightning',
                speed: 3.5,
                damage: 18,
                desc: "Calls down lightning!"
            },
            {
                name: "Steel Golem",
                health: 200,
                color: '#778899',
                size: {w: 60, h: 70},
                attackPattern: 'armored',
                speed: 1.5,
                damage: 25,
                desc: "Heavily armored!"
            },
            {
                name: "Demon General",
                health: 180,
                color: '#8b0000',
                size: {w: 55, h: 65},
                attackPattern: 'multi_attack',
                speed: 4,
                damage: 20,
                desc: "Unpredictable attacks!"
            },
            {
                name: "Dark Phoenix",
                health: 220,
                color: '#9400d3',
                size: {w: 70, h: 60},
                attackPattern: 'flying',
                speed: 5,
                damage: 22,
                desc: "Death from above!"
            },
            {
                name: "EVIL DRAGON",
                health: 300,
                color: '#ff0000',
                size: {w: 100, h: 80},
                attackPattern: 'dragon',
                speed: 3,
                damage: 30,
                desc: "The ultimate challenge!"
            }
        ];

        class Boss {
            constructor(level) {
                const data = bossData[level - 1];
                this.name = data.name;
                this.desc = data.desc;
                this.maxHealth = data.health;
                this.health = data.health;
                this.color = data.color;
                this.width = data.size.w;
                this.height = data.size.h;
                this.attackPattern = data.attackPattern;
                this.baseSpeed = data.speed;
                this.damage = data.damage;
                
                this.x = canvas.width - 150;
                this.y = 400;
                this.velocityX = 0;
                this.velocityY = 0;
                this.onGround = false;
                this.active = true;
                this.attacking = false;
                this.attackTimer = 0;
                this.attackCooldown = 0;
                this.projectiles = [];
                this.phase = 1;
                
                this.isFlying = (this.attackPattern === 'flying' || this.attackPattern === 'dragon');
                if (this.isFlying) {
                    this.y = 200;
                    this.flyAngle = 0;
                }
            }

            update() {
                if (!this.active) return;

                switch(this.attackPattern) {
                    case 'rush':
                        this.rushPattern();
                        break;
                    case 'slow_heavy':
                        this.slowHeavyPattern();
                        break;
                    case 'dual_slash':
                        this.dualSlashPattern();
                        break;
                    case 'fire_ranged':
                        this.fireRangedPattern();
                        break;
                    case 'ice_projectile':
                        this.iceProjectilePattern();
                        break;
                    case 'lightning':
                        this.lightningPattern();
                        break;
                    case 'armored':
                        this.armoredPattern();
                        break;
                    case 'multi_attack':
                        this.multiAttackPattern();
                        break;
                    case 'flying':
                        this.flyingPattern();
                        break;
                    case 'dragon':
                        this.dragonPattern();
                        break;
                }

                for (let proj of this.projectiles) {
                    proj.x += proj.vx;
                    proj.y += proj.vy;
                    proj.life--;
                    
                    if (!player.invincible &&
                        proj.x < player.x + player.width &&
                        proj.x + proj.size > player.x &&
                        proj.y < player.y + player.height &&
                        proj.y + proj.size > player.y) {
                        player.health -= this.damage * 0.5;
                        player.invincible = true;
                        player.invincibleTimer = 30;
                        proj.life = 0;
                    }
                }
                this.projectiles = this.projectiles.filter(p => p.life > 0);

                if (!this.isFlying) {
                    this.velocityY += game.gravity;
                    this.y += this.velocityY;

                    this.onGround = false;
                    for (let platform of game.platforms) {
                        if (this.velocityY >= 0 &&
                            this.x < platform.x + platform.width &&
                            this.x + this.width > platform.x &&
                            this.y + this.height >= platform.y &&
                            this.y + this.height <= platform.y + platform.height) {
                            this.y = platform.y - this.height;
                            this.velocityY = 0;
                            this.onGround = true;
                        }
                    }
                }

                this.x += this.velocityX;

                if (this.attackTimer > 0) this.attackTimer--;
                if (this.attackCooldown > 0) this.attackCooldown--;
                if (this.attackTimer === 0) this.attacking = false;

                if (!player.invincible && this.attacking &&
                    player.x < this.x + this.width &&
                    player.x + player.width > this.x &&
                    player.y < this.y + this.height &&
                    player.y + player.height > this.y) {
                    player.health -= this.damage;
                    player.invincible = true;
                    player.invincibleTimer = 60;
                    player.velocityY = -8;
                    player.velocityX = (player.x < this.x ? -5 : 5);
                }
            }

            rushPattern() {
                const distToPlayer = player.x - this.x;
                if (Math.abs(distToPlayer) > 100) {
                    this.velocityX = distToPlayer > 0 ? this.baseSpeed : -this.baseSpeed;
                } else {
                    this.velocityX *= 0.9;
                    if (this.attackCooldown === 0) {
                        this.attacking = true;
                        this.attackTimer = 20;
                        this.attackCooldown = 60;
                    }
                }
            }

            slowHeavyPattern() {
                const distToPlayer = player.x - this.x;
                if (Math.abs(distToPlayer) > 80) {
                    this.velocityX = distToPlayer > 0 ? this.baseSpeed : -this.baseSpeed;
                } else {
                    this.velocityX = 0;
                    if (this.attackCooldown === 0) {
                        this.attacking = true;
                        this.attackTimer = 40;
                        this.attackCooldown = 90;
                    }
                }
            }

            dualSlashPattern() {
                const distToPlayer = player.x - this.x;
                this.velocityX = distToPlayer > 0 ? this.baseSpeed : -this.baseSpeed;
                
                if (Math.abs(distToPlayer) < 120 && this.attackCooldown === 0) {
                    this.attacking = true;
                    this.attackTimer = 15;
                    this.attackCooldown = 40;
                }
            }

            fireRangedPattern() {
                const distToPlayer = player.x - this.x;
                if (Math.abs(distToPlayer) > 200) {
                    this.velocityX = distToPlayer > 0 ? this.baseSpeed : -this.baseSpeed;
                } else {
                    this.velocityX *= 0.8;
                    if (this.attackCooldown === 0) {
                        this.shootFireball();
                        this.attackCooldown = 60;
                    }
                }
            }

            shootFireball() {
                const dx = player.x - this.x;
                const dy = player.y - this.y;
                const dist = Math.sqrt(dx*dx + dy*dy);
                this.projectiles.push({
                    x: this.x + this.width/2,
                    y: this.y + this.height/2,
                    vx: (dx/dist) * 5,
                    vy: (dy/dist) * 5,
                    size: 12,
                    color: '#ff4500',
                    life: 120
                });
            }

            iceProjectilePattern() {
                const distToPlayer = player.x - this.x;
                if (Math.abs(distToPlayer) > 250) {
                    this.velocityX = distToPlayer > 0 ? this.baseSpeed : -this.baseSpeed;
                } else {
                    this.velocityX = 0;
                    if (this.attackCooldown === 0) {
                        this.shootIce();
                        this.attackCooldown = 50;
                    }
                }
            }

            shootIce() {
                for (let i = -1; i <= 1; i++) {
                    this.projectiles.push({
                        x: this.x + this.width/2,
                        y: this.y + this.height/2,
                        vx: -4 + i * 2,
                        vy: -3,
                        size: 10,
                        color: '#00ffff',
                        life: 150
                    });
                }
            }

            lightningPattern() {
                const distToPlayer = player.x - this.x;
                this.velocityX = distToPlayer > 0 ? this.baseSpeed : -this.baseSpeed;
                
                if (this.attackCooldown === 0) {
                    this.summonLightning();
                    this.attackCooldown = 80;
                }
            }

            summonLightning() {
                this.projectiles.push({
                    x: player.x,
                    y: 0,
                    vx: 0,
                    vy: 15,
                    size: 20,
                    color: '#ffff00',
                    life: 40
                });
            }

            armoredPattern() {
                const distToPlayer = player.x - this.x;
                if (Math.abs(distToPlayer) > 150) {
                    this.velocityX = distToPlayer > 0 ? this.baseSpeed : -this.baseSpeed;
                } else {
                    this.velocityX = 0;
                    if (this.attackCooldown === 0) {
                        this.attacking = true;
                        this.attackTimer = 50;
                        this.attackCooldown = 100;
                    }
                }
            }

            multiAttackPattern() {
                const distToPlayer = player.x - this.x;
                this.velocityX = distToPlayer > 0 ? this.baseSpeed : -this.baseSpeed;
                
                if (this.attackCooldown === 0) {
                    if (Math.abs(distToPlayer) < 100) {
                        this.attacking = true;
                        this.attackTimer = 25;
                    } else {
                        this.shootFireball();
                    }
                    this.attackCooldown = 50;
                }
            }

            flyingPattern() {
                this.flyAngle += 0.03;
                this.x = canvas.width/2 + Math.cos(this.flyAngle) * 200;
                this.y = 150 + Math.sin(this.flyAngle * 2) * 50;
                
                if (this.attackCooldown === 0) {
                    this.projectiles.push({
                        x: this.x + this.width/2,
                        y: this.y + this.height,
                        vx: 0,
                        vy: 8,
                        size: 15,
                        color: '#9400d3',
                        life: 80
                    });
                    this.attackCooldown = 40;
                }
            }

            dragonPattern() {
                this.flyAngle += 0.02;
                this.x = canvas.width/2 + Math.cos(this.flyAngle) * 250;
                this.y = 150 + Math.sin(this.flyAngle) * 80;
                
                if (this.health < this.maxHealth * 0.5 && this.phase === 1) {
                    this.phase = 2;
                    this.attackCooldown = 0;
                }
                
                if (this.attackCooldown === 0) {
                    if (this.phase === 1) {
                        this.shootFireball();
                        this.attackCooldown = 45;
                    } else {
                        this.shootFireball();
                        this.summonLightning();
                        this.attackCooldown = 35;
                    }
                }
            }

            takeDamage(amount) {
                if (this.attackPattern === 'armored') {
                    amount *= 0.5;
                }
                
                this.health -= amount;
                if (this.health <= 0) {
                    this.active = false;
                    game.score += 1000 * game.currentLevel;
                    return true;
                }
                return false;
            }

            draw() {
                if (!this.active) return;

                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                ctx.fillStyle = '#000';
                if (this.attackPattern === 'dragon') {
                    ctx.fillStyle = this.color;
                    ctx.globalAlpha = 0.7;
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y + 20);
                    ctx.lineTo(this.x - 40, this.y);
                    ctx.lineTo(this.x - 30, this.y + 40);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.moveTo(this.x + this.width, this.y + 20);
                    ctx.lineTo(this.x + this.width + 40, this.y);
                    ctx.lineTo(this.x + this.width + 30, this.y + 40);
                    ctx.fill();
                    ctx.globalAlpha = 1;
                    
                    ctx.fillStyle = '#ffff00';
                    ctx.fillRect(this.x + 20, this.y + 25, 8, 8);
                    ctx.fillRect(this.x + 70, this.y + 25, 8, 8);
                    
                    // Dragon horns
                    ctx.fillStyle = '#8b0000';
                    ctx.fillRect(this.x + 15, this.y - 10, 8, 15);
                    ctx.fillRect(this.x + 75, this.y - 10, 8, 15);
                } else if (this.attackPattern === 'flying') {
                    ctx.fillStyle = '#ff00ff';
                    ctx.fillRect(this.x - 20, this.y + 10, 15, 30);
                    ctx.fillRect(this.x + this.width + 5, this.y + 10, 15, 30);
                    
                    ctx.fillStyle = '#fff';
                    const eyeY = this.y + this.height * 0.3;
                    ctx.fillRect(this.x + this.width * 0.25, eyeY, 6, 6);
                    ctx.fillRect(this.x + this.width * 0.65, eyeY, 6, 6);
                } else {
                    ctx.fillStyle = '#ff0000';
                    const eyeY = this.y + this.height * 0.3;
                    ctx.fillRect(this.x + this.width * 0.25, eyeY, 6, 6);
                    ctx.fillRect(this.x + this.width * 0.65, eyeY, 6, 6);
                }
                
                if (this.attacking) {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.fillRect(this.x - 10, this.y, this.width + 20, this.height);
                }

                for (let proj of this.projectiles) {
                    ctx.fillStyle = proj.color;
                    ctx.beginPath();
                    ctx.arc(proj.x, proj.y, proj.size/2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    if (proj.color === '#ffff00') {
                        ctx.strokeStyle = '#fff';
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    }
                }
                
                const barWidth = 200;
                const barX = canvas.width/2 - barWidth/2;
                ctx.fillStyle = '#000';
                ctx.fillRect(barX - 2, 18, barWidth + 4, 24);
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(barX, 20, barWidth, 20);
                ctx.fillStyle = '#00ff00';
                ctx.fillRect(barX, 20, (this.health / this.maxHealth) * barWidth, 20);
                
                ctx.fillStyle = '#fff';
                ctx.font = '16px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText(this.name, canvas.width/2, 15);
            }
        }

        class Projectile {
            constructor(x, y, direction) {
                this.x = x;
                this.y = y;
                this.width = 8;
                this.height = 8;
                this.speed = 10 * direction;
                this.active = true;
            }

            update() {
                this.x += this.speed;
                
                if (this.x < 0 || this.x > canvas.width) {
                    this.active = false;
                }

                if (game.boss && game.boss.active &&
                    this.x < game.boss.x + game.boss.width &&
                    this.x + this.width > game.boss.x &&
                    this.y < game.boss.y + game.boss.height &&
                    this.y + this.height > game.boss.y) {
                    game.boss.takeDamage(15);
                    this.active = false;
                }
            }

            draw() {
                if (!this.active) return;
                
                ctx.save();
                ctx.translate(this.x + this.width/2, this.y + this.height/2);
                ctx.rotate(Date.now() / 50);
                
                ctx.fillStyle = '#ffff00';
                ctx.beginPath();
                for (let i = 0; i < 4; i++) {
                    const angle = (i * Math.PI) / 2;
                    const x = Math.cos(angle) * 6;
                    const y = Math.sin(angle) * 6;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.closePath();
                ctx.fill();
                ctx.restore();
            }
        }

        function createBoss(level) {
            game.boss = new Boss(level);
            player.health = player.maxHealth;
        }

        function updatePlayer() {
            if (game.keys['ArrowLeft']) {
                player.velocityX = -player.speed;
                player.facing = -1;
            } else if (game.keys['ArrowRight']) {
                player.velocityX = player.speed;
                player.facing = 1;
            } else {
                player.velocityX *= 0.8;
            }

            if (game.keys['ArrowUp'] && player.onGround) {
                player.velocityY = -player.jumpPower;
                player.onGround = false;
            }

            if (game.keys['z'] && !player.attacking) {
                player.attacking = true;
                player.attackTimer = 15;
                
                if (game.boss && game.boss.active) {
                    const attackRange = 50;
                    const dx = (game.boss.x + game.boss.width/2) - (player.x + player.width/2);
                    const dy = (game.boss.y + game.boss.height/2) - (player.y + player.height/2);
                    const distance = Math.sqrt(dx*dx + dy*dy);
                    
                    if (distance < attackRange && Math.sign(dx) === player.facing) {
                        game.boss.takeDamage(20);
                    }
                }
            }

            if (game.keys['x'] && game.starCooldown === 0) {
                game.projectiles.push(new Projectile(
                    player.x + player.width/2,
                    player.y + player.height/2,
                    player.facing
                ));
                game.starCooldown = 15;
                game.keys['x'] = false;
            }

            player.velocityY += game.gravity;
            player.x += player.velocityX;
            player.y += player.velocityY;

            player.onGround = false;
            for (let platform of game.platforms) {
                if (player.velocityY >= 0 &&
                    player.x < platform.x + platform.width &&
                    player.x + player.width > platform.x &&
                    player.y + player.height >= platform.y &&
                    player.y + player.height <= platform.y + platform.height) {
                    player.y = platform.y - player.height;
                    player.velocityY = 0;
                    player.onGround = true;
                }
            }

            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
            if (player.y > canvas.height) {
                player.y = 100;
                player.health -= 20;
            }

            if (player.attackTimer > 0) {
                player.attackTimer--;
                if (player.attackTimer === 0) player.attacking = false;
            }

            if (player.invincibleTimer > 0) {
                player.invincibleTimer--;
                if (player.invincibleTimer === 0) player.invincible = false;
            }

            if (game.starCooldown > 0) game.starCooldown--;

            if (player.health <= 0) {
                game.running = false;
                setTimeout(() => {
                    alert('Game Over!\nFinal Score: ' + game.score + '\nLevel Reached: ' + game.currentLevel);
                    location.reload();
                }, 100);
            }
        }

        function drawPlayer() {
            if (player.invincible && Math.floor(Date.now() / 100) % 2 === 0) {
                return;
            }

            ctx.fillStyle = '#000080';
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            ctx.fillStyle = '#fff';
            ctx.fillRect(player.x + 10, player.y + 12, 10, 6);
            
            if (player.attacking) {
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(
                    player.x + (player.facing === 1 ? player.width : -20),
                    player.y + 10,
                    20,
                    4
                );
            }
        }

        function drawPlatforms() {
            ctx.fillStyle = '#654321';
            for (let platform of game.platforms) {
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                
                ctx.strokeStyle = '#4a3319';
                ctx.lineWidth = 2;
                for (let i = 0; i < platform.width; i += 30) {
                    ctx.beginPath();
                    ctx.moveTo(platform.x + i, platform.y);
                    ctx.lineTo(platform.x + i, platform.y + platform.height);
                    ctx.stroke();
                }
            }
        }

        function gameLoop() {
            if (!game.running) return;

            ctx.fillStyle = '#0f3460';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#1a1a3e';
            for (let i = 0; i < 50; i++) {
                const x = (i * 37) % canvas.width;
                const y = (i * 53) % canvas.height;
                ctx.fillRect(x, y, 2, 2);
            }

            drawPlatforms();

            if (game.boss && !game.boss.active && !game.transitioning) {
                game.transitioning = true;
                game.transitionTimer = 120;
                
                if (game.currentLevel >= game.maxLevel) {
                    setTimeout(() => {
                        alert('üéâ CONGRATULATIONS! üéâ\n\nYou defeated the Evil Dragon!\n\nFinal Score: ' + game.score + '\n\nYou are a true NINJA MASTER!');
                        location.reload();
                    }, 2000);
                    game.running = false;
                }
            }

            if (game.transitioning) {
                game.transitionTimer--;
                
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#ffff00';
                ctx.font = 'bold 40px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText('VICTORY!', canvas.width/2, canvas.height/2 - 40);
                
                ctx.fillStyle = '#00ff00';
                ctx.font = '24px Courier New';
                ctx.fillText('Score +' + (1000 * game.currentLevel), canvas.width/2, canvas.height/2);
                
                ctx.fillStyle = '#fff';
                ctx.font = '18px Courier New';
                ctx.fillText('Next challenger approaching...', canvas.width/2, canvas.height/2 + 40);
                
                if (game.transitionTimer === 0) {
                    game.currentLevel++;
                    if (game.currentLevel <= game.maxLevel) {
                        createBoss(game.currentLevel);
                        game.transitioning = false;
                    }
                }
            } else {
                updatePlayer();
                drawPlayer();

                if (game.boss) {
                    game.boss.update();
                    game.boss.draw();
                }

                for (let proj of game.projectiles) {
                    proj.update();
                    proj.draw();
                }

                game.projectiles = game.projectiles.filter(p => p.active);
            }

            document.getElementById('health').textContent = 'Health: ' + Math.max(0, Math.floor(player.health));
            document.getElementById('score').textContent = 'Score: ' + game.score;
            document.getElementById('level').textContent = 'Level: ' + game.currentLevel + '/' + game.maxLevel;

            requestAnimationFrame(gameLoop);
        }

        window.addEventListener('keydown', (e) => {
            game.keys[e.key] = true;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
            }
        });

        window.addEventListener('keyup', (e) => {
            game.keys[e.key] = false;
        });

        createBoss(1);
        gameLoop();
    </script>
</body>
</html>