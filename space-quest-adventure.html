<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nebula Drifters - A Space Quest Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            color: #00ff00;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        #sceneContainer {
            position: relative;
            flex: 1;
            overflow: hidden;
            cursor: crosshair;
        }
        
        #sceneImage {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }
        
        .hotspot {
            position: absolute;
            border: 2px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .hotspot:hover {
            border: 2px solid rgba(255, 255, 0, 0.8);
            background: rgba(255, 255, 0, 0.1);
        }
        
        #textBox {
            background: rgba(0, 0, 0, 0.95);
            border-top: 3px solid #00ff00;
            padding: 15px;
            min-height: 80px;
            max-height: 120px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.4;
        }
        
        #verbInterface {
            background: rgba(0, 20, 40, 0.95);
            border-top: 2px solid #00ffff;
            padding: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }
        
        .verb-btn {
            background: linear-gradient(180deg, #2a4a6a, #1a3a5a);
            border: 2px solid #4a8aaa;
            color: #00ffff;
            padding: 8px 16px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
        }
        
        .verb-btn:hover {
            background: linear-gradient(180deg, #3a5a7a, #2a4a6a);
            border-color: #00ffff;
            box-shadow: 0 0 10px #00ffff;
            transform: translateY(-2px);
        }
        
        .verb-btn.active {
            background: linear-gradient(180deg, #5a7a9a, #4a6a8a);
            border-color: #ffff00;
            color: #ffff00;
            box-shadow: 0 0 15px #ffff00;
        }
        
        #inventory {
            display: flex;
            gap: 5px;
            align-items: center;
            padding: 5px 10px;
            background: rgba(20, 20, 40, 0.9);
            border: 2px solid #8a4aaa;
            border-radius: 5px;
        }
        
        .inventory-item {
            background: rgba(60, 40, 80, 0.8);
            border: 2px solid #aa6acc;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            color: #ff88ff;
        }
        
        .inventory-item:hover {
            background: rgba(80, 50, 100, 1);
            border-color: #ff88ff;
            transform: scale(1.1);
        }
        
        .inventory-item.selected {
            border-color: #ffff00;
            color: #ffff00;
            box-shadow: 0 0 10px #ffff00;
        }
        
        #scoreDisplay {
            background: rgba(20, 40, 20, 0.9);
            border: 2px solid #00ff00;
            padding: 5px 15px;
            font-size: 14px;
            font-weight: bold;
        }
        
        #dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.98);
            border: 4px solid #00ff00;
            padding: 30px;
            min-width: 400px;
            max-width: 600px;
            display: none;
            z-index: 1000;
            box-shadow: 0 0 50px rgba(0, 255, 0, 0.5);
        }
        
        #dialog.active {
            display: block;
        }
        
        #dialogNPC {
            color: #00ffff;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        #dialogText {
            color: #ffff00;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .dialog-option {
            background: rgba(20, 40, 60, 0.9);
            border: 2px solid #4a8aaa;
            color: #00ffff;
            padding: 10px 15px;
            margin: 5px 0;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }
        
        .dialog-option:hover {
            background: rgba(40, 60, 80, 1);
            border-color: #00ffff;
            transform: translateX(10px);
        }
        
        #deathScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        #deathScreen.active {
            display: flex;
        }
        
        #deathText {
            color: #ff0000;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            max-width: 600px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }
        
        .death-btn {
            background: #ff0000;
            border: 2px solid #ffff00;
            color: #000;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            font-family: 'Courier New', monospace;
        }
        
        .death-btn:hover {
            background: #ff3333;
            transform: scale(1.1);
        }
        
        #cursor {
            position: fixed;
            pointer-events: none;
            z-index: 10000;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.8);
            padding: 3px 8px;
            border: 1px solid #00ff00;
            border-radius: 3px;
            display: none;
        }
        
        #mapButton {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(20, 40, 60, 0.9);
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 10px 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            z-index: 100;
        }
        
        #mapButton:hover {
            background: rgba(40, 60, 80, 1);
            box-shadow: 0 0 10px #00ff00;
        }
    </style>
</head>
<body>
    <div id="cursor"></div>
    
    <button id="mapButton">‚óÑ MAP</button>
    
    <div id="gameContainer">
        <div id="sceneContainer">
            <img id="sceneImage" src="d9fe6f01-ef4f-4735-8adf-e145e5819870_neuroflash-think_sierra_games_-_leisure_suit_larry_-_but_wer_1762188291.png" alt="Current Scene">
            <!-- Hotspots will be added dynamically -->
        </div>
        
        <div id="textBox">
            Welcome to NEBULA DRIFTERS! You are Space Janitor Roger Wilco... er, Space Custodian Rex Nova. Your ship has crashed in an uncharted sector. Click the map to explore!
        </div>
        
        <div id="verbInterface">
            <button class="verb-btn" data-verb="look">üëÅ LOOK</button>
            <button class="verb-btn" data-verb="walk">üëü WALK</button>
            <button class="verb-btn" data-verb="take">‚úã TAKE</button>
            <button class="verb-btn" data-verb="use">üîß USE</button>
            <button class="verb-btn" data-verb="talk">üí¨ TALK</button>
            <button class="verb-btn" data-verb="taste">üëÖ TASTE</button>
            
            <div id="inventory">
                <span style="color: #ff88ff;">üì¶ INV:</span>
                <!-- Inventory items appear here -->
            </div>
            
            <div id="scoreDisplay">
                ‚≠ê SCORE: <span id="score">0</span>/1000
            </div>
        </div>
    </div>
    
    <div id="dialog">
        <div id="dialogNPC"></div>
        <div id="dialogText"></div>
        <div id="dialogOptions"></div>
    </div>
    
    <div id="deathScreen">
        <div id="deathText"></div>
        <button class="death-btn" onclick="restoreGame()">TRY AGAIN</button>
        <button class="death-btn" onclick="location.reload()">RESTART</button>
    </div>

    <script>
        // Game State
        const game = {
            currentScene: 'map',
            currentVerb: 'look',
            selectedItem: null,
            inventory: [],
            score: 0,
            flags: {},
            savedState: null
        };

        // Scene Definitions with TONS of hotspots!
        const scenes = {
            map: {
                image: 'd9fe6f01-ef4f-4735-8adf-e145e5819870_neuroflash-think_sierra_games_-_leisure_suit_larry_-_but_wer_1762188291.png',
                name: 'Cosmic Map',
                hotspots: [
                    { id: 'nebula', x: 5, y: 5, w: 25, h: 35, name: 'Nebula Noodle Arm', scene: 'nebula', 
                      desc: 'A swirling nebula filled with alien jellies and cosmic pasta.' },
                    { id: 'quantum', x: 70, y: 5, w: 25, h: 35, name: 'Quantum Quasar Quadrant', scene: 'quantum',
                      desc: 'Strange geometric structures defying the laws of physics.' },
                    { id: 'saloon', x: 35, y: 25, w: 30, h: 35, name: 'Stardust Saloon', scene: 'saloon',
                      desc: 'The rowdiest spaceport this side of the galaxy!' },
                    { id: 'fungal', x: 5, y: 55, w: 30, h: 40, name: 'Fungal Forest', scene: 'fungal',
                      desc: 'Giant mushrooms and things with too many teeth.' },
                    { id: 'rust', x: 65, y: 55, w: 30, h: 40, name: 'Rust Belt Expanse', scene: 'rust',
                      desc: 'Abandoned machinery and broken dreams.' }
                ]
            },
            
            fungal: {
                image: 'fungal-forest-frontier.png',
                name: 'Fungal Forest Frontier',
                hotspots: [
                    { id: 'guardian', x: 42, y: 35, w: 16, h: 30, name: 'Mushroom Guardian',
                      look: 'A massive sentient mushroom creature. It looks like it could use a hug... or eat you.',
                      talk: { npc: 'Mushroom Guardian', text: 'SPORE! You dare trespass in my fungal domain?!', 
                        options: [
                          { text: 'Sorry, just passing through!', action: () => addScore(10, 'Guardian: "Pass... but watch your step!"') },
                          { text: 'Fight me, fungus!', action: () => death('The Guardian releases toxic spores. You really thought you could fight a giant mushroom?') },
                          { text: 'Want to be friends?', action: () => { addScore(25, 'Guardian: "Friend... yes! Take spore powder!"'); addItem('Spore Powder'); } }
                        ]
                      }
                    },
                    { id: 'portal', x: 85, y: 45, w: 10, h: 20, name: 'Glowing Portal',
                      look: 'A shimmering green portal. Probably safe. Maybe.',
                      use: { check: () => !game.flags.portalUsed, 
                        success: () => { game.flags.portalUsed = true; addScore(50, 'You step through... and arrive at the Nebula Noodle Arm!'); changeScene('nebula'); },
                        fail: () => setText('The portal is dormant now.') }
                    },
                    { id: 'castle', x: 35, y: 8, w: 30, h: 25, name: 'Crystal Castle',
                      look: 'A magnificent pink crystal castle in the distance. Probably has a princess in it.',
                      walk: () => death('You walk toward the castle and fall into a mushroom pit. Those red cap mushrooms? Turns out they\'re carnivorous.')
                    },
                    { id: 'leftshroom', x: 5, y: 15, w: 20, h: 30, name: 'Giant Blue Mushroom',
                      look: 'A massive blue mushroom with glowing spots. Looks psychedelic.',
                      taste: () => { addScore(5, 'It tastes like cosmic blueberries! Your vision swirls...'); 
                        if (!game.flags.shroomTasted) { game.flags.shroomTasted = true; addItem('Mushroom Sample'); } },
                      take: () => setText('It\'s rooted to the ground and weighs about 3 tons.')
                    },
                    { id: 'rightshroom', x: 75, y: 15, w: 20, h: 30, name: 'Giant Teal Mushroom',
                      look: 'Another enormous mushroom. This one has a little door at the base!',
                      use: () => { if (!game.flags.shroomHouse) { game.flags.shroomHouse = true; addScore(15, 'Inside you find a tiny alien family having dinner. They wave!'); } }
                    },
                    { id: 'rocks', x: 60, y: 70, w: 15, h: 10, name: 'Strange Rocks',
                      look: 'Pink crystalline rocks scattered around.',
                      take: { check: () => !hasItem('Crystal Rock'),
                        success: () => { addItem('Crystal Rock'); addScore(5, 'You pocket a pretty crystal rock.'); },
                        fail: () => setText('You already have enough rocks.') }
                    },
                    { id: 'comet', x: 60, y: 8, w: 10, h: 5, name: 'Comet',
                      look: 'A comet streaking across the sky. Majestic!',
                      use: () => setText('You can\'t reach it, genius.')
                    },
                    { id: 'planet1', x: 8, y: 5, w: 8, h: 8, name: 'Blue Planet',
                      look: 'A beautiful blue planet with rings. Looks habitable!',
                      use: () => setText('You\'d need a ship to get there. Oh wait, yours crashed.')
                    },
                    { id: 'planet2', x: 38, y: 6, w: 10, h: 10, name: 'Orange Planet',
                      look: 'An orange gas giant. Probably full of deadly storms.',
                      taste: () => death('You lick your finger and hold it up toward the planet. Space madness claims you.')
                    }
                ]
            },
            
            nebula: {
                image: 'nebula-noodle-arm.png',
                name: 'Nebula Noodle Arm - Underground City',
                hotspots: [
                    { id: 'building1', x: 15, y: 45, w: 15, h: 20, name: 'Mushroom House',
                      look: 'A cozy house built into a glowing mushroom. Smoke rises from the chimney.',
                      talk: () => showDialog('Mushroom Resident', 'Hey spacer! Welcome to our humble spore-munity!', [
                        { text: 'Nice place!', action: () => { addScore(5, 'They seem pleased!'); closeDialog(); } },
                        { text: 'Spore-munity? Really?', action: () => { setText('They shrug. "We\'re working on better puns."'); closeDialog(); } }
                      ])
                    },
                    { id: 'building2', x: 35, y: 35, w: 18, h: 25, name: 'Crystal Tower',
                      look: 'A towering structure made of cyan crystals, pulsing with energy.',
                      use: { check: () => hasItem('Crystal Rock'),
                        success: () => { removeItem('Crystal Rock'); addScore(50, 'The tower resonates! A secret passage opens!'); game.flags.towerActivated = true; },
                        fail: () => setText('The tower hums, but nothing happens. Maybe it needs something?') }
                    },
                    { id: 'building3', x: 60, y: 40, w: 12, h: 18, name: 'Lantern Shop',
                      look: 'A shop selling bioluminescent lanterns.',
                      talk: () => showDialog('Lantern Seller', 'Buy lantern? Only 5 galactic credits!', [
                        { text: 'Buy Lantern', action: () => { addItem('Lantern'); addScore(10, 'You acquire a glowing lantern!'); closeDialog(); } },
                        { text: 'No thanks', action: () => closeDialog() }
                      ])
                    },
                    { id: 'crystals', x: 25, y: 55, w: 10, h: 15, name: 'Pink Crystals',
                      look: 'Vibrant pink crystals jutting from the ground.',
                      take: () => death('You grab a crystal. It shatters and releases a neurotoxin. Your last thought: "Worth it."')
                    },
                    { id: 'bridge', x: 40, y: 55, w: 20, h: 5, name: 'Rope Bridge',
                      look: 'A rickety rope bridge connecting platforms.',
                      walk: () => { addScore(10, 'You carefully cross the bridge. It creaks ominously.'); }
                    },
                    { id: 'cave1', x: 5, y: 30, w: 10, h: 15, name: 'Dark Cave',
                      look: 'A dark cave entrance. You hear echoes from within.',
                      walk: { check: () => hasItem('Lantern'),
                        success: () => { addScore(25, 'Using your lantern, you explore the cave and find ancient ruins!'); },
                        fail: () => death('You walk into the dark cave and immediately fall down a bottomless pit. Next time, bring a light.') }
                    },
                    { id: 'creature', x: 50, y: 65, w: 8, h: 10, name: 'Small Alien',
                      look: 'A small, friendly-looking alien creature.',
                      talk: () => showDialog('Alien', '*Chirps happily*', [
                        { text: 'Pet it', action: () => { addScore(15, 'The alien purrs! So cute!'); closeDialog(); } },
                        { text: 'Ignore', action: () => closeDialog() }
                      ]),
                      taste: () => death('You try to lick the alien. It secretes acid. Why would you do that?')
                    }
                ]
            },
            
            quantum: {
                image: 'quantum-quasar-quadrant.png',
                name: 'Quantum Quasar Quadrant',
                hotspots: [
                    { id: 'ship', x: 55, y: 45, w: 20, h: 15, name: 'Crashed Ship',
                      look: 'Your crashed ship. The hull is scorched and the engines are toast.',
                      use: { check: () => hasItem('Spore Powder'),
                        success: () => { removeItem('Spore Powder'); addScore(100, 'You use spore powder as fuel! The ship powers on!'); game.flags.shipFixed = true; },
                        fail: () => setText('The ship needs some kind of energy source to restart.') },
                      take: () => { if (!hasItem('Ship Key')) { addItem('Ship Key'); addScore(10, 'You grab the ship key!'); } }
                    },
                    { id: 'crystal1', x: 15, y: 30, w: 8, h: 25, name: 'Cyan Crystal Spire',
                      look: 'A tall cyan crystal reaching toward the swirling sky.',
                      take: () => setText('Too big and probably important to the planet\'s structure.')
                    },
                    { id: 'crystal2', x: 30, y: 25, w: 8, h: 30, name: 'Purple Crystal Spire',
                      look: 'A massive purple crystal humming with energy.',
                      use: () => { addScore(20, 'The crystal pulses and shows you a vision of the universe!'); }
                    },
                    { id: 'crystal3', x: 75, y: 35, w: 8, h: 20, name: 'Pink Crystal Spire',
                      look: 'A pink crystal glowing softly.',
                      talk: () => showDialog('Crystal', '*The crystal whispers telepathically* "Seeker... the answer is 42."', [
                        { text: 'What\'s the question?', action: () => { addScore(25, 'Crystal: "Exactly."'); closeDialog(); } }
                      ])
                    },
                    { id: 'debris1', x: 40, y: 65, w: 10, h: 8, name: 'Metal Debris',
                      look: 'Scattered metal debris from various spacecraft.',
                      take: { check: () => !hasItem('Metal Scrap'),
                        success: () => { addItem('Metal Scrap'); addScore(5, 'You collect some metal scrap.'); },
                        fail: () => setText('You have enough junk.') }
                    },
                    { id: 'glitter', x: 45, y: 70, w: 25, h: 10, name: 'Space Glitter',
                      look: 'Mysterious glittering particles on the ground. Pretty!',
                      take: () => { addScore(10, 'You scoop up some space glitter. It\'s fabulous.'); if (!hasItem('Space Glitter')) addItem('Space Glitter'); },
                      taste: () => death('You eat space glitter. Turns out it\'s made of tiny glass shards. Your mouth is now a disco ball of pain.')
                    }
                ]
            },
            
            rust: {
                image: 'rust-belt-expanse.png',
                name: 'Rust Belt Expanse - Planet Gloworia',
                hotspots: [
                    { id: 'ship1', x: 8, y: 30, w: 15, h: 12, name: 'Blue Spaceship',
                      look: 'A sleek blue spacecraft on a landing pad.',
                      use: { check: () => game.flags.shipFixed && hasItem('Ship Key'),
                        success: () => { addScore(200, 'You board the ship and blast off! MISSION COMPLETE!'); alert('CONGRATULATIONS! You escaped with ' + game.score + ' points!'); },
                        fail: () => setText('This ship is locked. You need a key and working engines.') }
                    },
                    { id: 'ship2', x: 77, y: 30, w: 15, h: 12, name: 'Orange Spaceship',
                      look: 'An old orange cargo hauler. Looks abandoned.',
                      take: () => { if (!hasItem('Fuel Cell')) { addItem('Fuel Cell'); addScore(15, 'You find a fuel cell inside!'); } }
                    },
                    { id: 'bridge', x: 35, y: 45, w: 30, h: 5, name: 'Glass Bridge',
                      look: 'A transparent bridge over a massive drop. You can see an underground city below!',
                      walk: () => { addScore(10, 'You walk carefully across the bridge. Don\'t look down!'); },
                      taste: () => death('You lick the glass bridge. Your tongue freezes to it. Eventually you fall.')
                    },
                    { id: 'city', x: 35, y: 60, w: 30, h: 20, name: 'Underground City',
                      look: 'A beautiful crystalline city visible through the glass below. Mushroom structures everywhere.',
                      walk: () => setText('The city is too far below to reach from here.')
                    },
                    { id: 'mushroom1', x: 5, y: 45, w: 15, h: 25, name: 'Giant Mushroom Structure',
                      look: 'A colossal mushroom-shaped building or natural formation.',
                      talk: () => showDialog('Mushroom', '*The mushroom emanates a sense of ancient wisdom*', [
                        { text: 'Ask for wisdom', action: () => { addScore(30, 'The mushroom shares: "The universe is a fungi place."'); closeDialog(); } }
                      ])
                    },
                    { id: 'mountains', x: 20, y: 20, w: 60, h: 15, name: 'Golden Mountains',
                      look: 'Spectacular golden mountains stretch across the horizon.',
                      use: () => setText('You admire the view. It\'s breathtaking.')
                    }
                ]
            },
            
            saloon: {
                image: 'stardust-saloon.png',
                name: 'Spaceport Plutonia',
                hotspots: [
                    { id: 'portal', x: 15, y: 40, w: 15, h: 20, name: 'Dimensional Portal',
                      look: 'A swirling portal crackling with energy.',
                      use: { check: () => hasItem('Space Glitter'),
                        success: () => { removeItem('Space Glitter'); addScore(75, 'You toss glitter into the portal. It stabilizes!'); game.flags.portalStable = true; },
                        fail: () => setText('The portal is unstable. It needs something to stabilize it.') },
                      walk: { check: () => game.flags.portalStable,
                        success: () => { addScore(50, 'You step through and emerge in another dimension!'); },
                        fail: () => death('You jump into the unstable portal and are scattered across 7 dimensions.') }
                    },
                    { id: 'alien1', x: 30, y: 55, w: 5, h: 10, name: 'Green Alien',
                      look: 'A green alien in an orange spacesuit.',
                      talk: () => showDialog('Zyx', 'Hey human! Want to hear a joke? What do you call a space detective? An astro-nut!', [
                        { text: 'Ha! Good one!', action: () => { addScore(5, 'Zyx is pleased!'); closeDialog(); } },
                        { text: 'That\'s terrible', action: () => { setText('Zyx looks hurt.'); closeDialog(); } }
                      ])
                    },
                    { id: 'alien2', x: 45, y: 60, w: 5, h: 10, name: 'Orange Alien',
                      look: 'An orange alien smoking something suspicious.',
                      talk: () => showDialog('Blorp', 'Dude... the universe is like... a hologram, man.', [
                        { text: 'Deep', action: () => closeDialog() }
                      ])
                    },
                    { id: 'ufo1', x: 25, y: 35, w: 12, h: 8, name: 'Classic UFO',
                      look: 'A silver flying saucer. Very retro.',
                      use: () => setText('Locked. Probably for the best.')
                    },
                    { id: 'ufo2', x: 60, y: 30, w: 15, h: 10, name: 'Modern Cruiser',
                      look: 'A sleek modern spacecraft.',
                      take: () => death('You try to steal the ship. The owner vaporizes you with a plasma rifle.')
                    },
                    { id: 'crowd', x: 35, y: 50, w: 30, h: 25, name: 'Alien Crowd',
                      look: 'Dozens of aliens from across the galaxy mingling.',
                      talk: () => { addScore(20, 'You mingle with the crowd. Someone mentions a ship dealer on the east side.'); }
                    }
                ]
            }
        };

        // UI Elements
        const sceneImage = document.getElementById('sceneImage');
        const sceneContainer = document.getElementById('sceneContainer');
        const textBox = document.getElementById('textBox');
        const verbBtns = document.querySelectorAll('.verb-btn');
        const inventory = document.getElementById('inventory');
        const scoreDisplay = document.getElementById('score');
        const cursor = document.getElementById('cursor');
        const dialog = document.getElementById('dialog');
        const mapButton = document.getElementById('mapButton');
        const deathScreen = document.getElementById('deathScreen');

        // Initialize
        function init() {
            verbBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    verbBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    game.currentVerb = btn.dataset.verb;
                    setText('Selected: ' + btn.dataset.verb.toUpperCase());
                });
            });
            
            verbBtns[0].classList.add('active');
            
            mapButton.addEventListener('click', () => {
                if (game.currentScene !== 'map') {
                    changeScene('map');
                }
            });
            
            changeScene('map');
        }

        function changeScene(sceneId) {
            game.currentScene = sceneId;
            const scene = scenes[sceneId];
            sceneImage.src = scene.image;
            setText('Arrived at: ' + scene.name);
            
            // Clear old hotspots
            document.querySelectorAll('.hotspot').forEach(h => h.remove());
            
            // Add new hotspots
            scene.hotspots.forEach(hotspot => {
                const div = document.createElement('div');
                div.className = 'hotspot';
                div.style.left = hotspot.x + '%';
                div.style.top = hotspot.y + '%';
                div.style.width = hotspot.w + '%';
                div.style.height = hotspot.h + '%';
                
                div.addEventListener('click', () => handleHotspotClick(hotspot));
                div.addEventListener('mouseenter', () => {
                    cursor.textContent = game.currentVerb.toUpperCase() + ' ' + hotspot.name;
                    cursor.style.display = 'block';
                });
                div.addEventListener('mouseleave', () => {
                    cursor.style.display = 'none';
                });
                
                sceneContainer.appendChild(div);
            });
        }

        function handleHotspotClick(hotspot) {
            const verb = game.currentVerb;
            
            // Special scene transitions
            if (hotspot.scene) {
                changeScene(hotspot.scene);
                addScore(10, 'Exploring new location!');
                return;
            }
            
            // Check for verb-specific actions
            if (hotspot[verb]) {
                const action = hotspot[verb];
                
                // If it's a function
                if (typeof action === 'function') {
                    action();
                }
                // If it's an object with check/success/fail
                else if (action.check) {
                    if (action.check()) {
                        action.success();
                    } else {
                        action.fail();
                    }
                }
                // If it's a dialog object
                else if (action.npc) {
                    showDialog(action.npc, action.text, action.options);
                }
            } else {
                // Default responses
                switch(verb) {
                    case 'look':
                        setText(hotspot.look || 'You see ' + hotspot.name);
                        break;
                    case 'walk':
                        setText('You walk toward ' + hotspot.name);
                        break;
                    case 'take':
                        setText('You can\'t take that.');
                        break;
                    case 'use':
                        setText('That doesn\'t seem to work.');
                        break;
                    case 'talk':
                        setText('There\'s no response.');
                        break;
                    case 'taste':
                        setText('You\'re not tasting that. Use your brain.');
                        break;
                }
            }
        }

        function setText(text) {
            textBox.textContent = text;
        }

        function addScore(points, message) {
            game.score += points;
            scoreDisplay.textContent = game.score;
            if (message) setText(message + ' [+' + points + ' points]');
        }

        function addItem(item) {
            if (!game.inventory.includes(item)) {
                game.inventory.push(item);
                updateInventory();
                setText('Added to inventory: ' + item);
            }
        }

        function removeItem(item) {
            const index = game.inventory.indexOf(item);
            if (index > -1) {
                game.inventory.splice(index, 1);
                updateInventory();
            }
        }

        function hasItem(item) {
            return game.inventory.includes(item);
        }

        function updateInventory() {
            // Clear current items
            const items = inventory.querySelectorAll('.inventory-item');
            items.forEach(item => item.remove());
            
            // Add items
            game.inventory.forEach(item => {
                const div = document.createElement('div');
                div.className = 'inventory-item';
                div.textContent = item;
                div.onclick = () => {
                    game.selectedItem = item;
                    document.querySelectorAll('.inventory-item').forEach(i => i.classList.remove('selected'));
                    div.classList.add('selected');
                    setText('Selected: ' + item);
                };
                inventory.appendChild(div);
            });
        }

        function showDialog(npc, text, options) {
            document.getElementById('dialogNPC').textContent = npc;
            document.getElementById('dialogText').textContent = text;
            
            const optionsDiv = document.getElementById('dialogOptions');
            optionsDiv.innerHTML = '';
            
            options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = 'dialog-option';
                div.textContent = (index + 1) + '. ' + option.text;
                div.onclick = option.action;
                optionsDiv.appendChild(div);
            });
            
            dialog.classList.add('active');
        }

        function closeDialog() {
            dialog.classList.remove('active');
        }

        function death(message) {
            game.savedState = {
                scene: game.currentScene,
                score: game.score,
                inventory: [...game.inventory],
                flags: {...game.flags}
            };
            
            document.getElementById('deathText').textContent = 'üíÄ ' + message + ' üíÄ';
            deathScreen.classList.add('active');
        }

        function restoreGame() {
            if (game.savedState) {
                game.currentScene = game.savedState.scene;
                game.score = game.savedState.score;
                game.inventory = game.savedState.inventory;
                game.flags = game.savedState.flags;
                scoreDisplay.textContent = game.score;
                updateInventory();
                changeScene(game.currentScene);
            }
            deathScreen.classList.remove('active');
        }

        // Cursor follow
        document.addEventListener('mousemove', (e) => {
            cursor.style.left = (e.clientX + 15) + 'px';
            cursor.style.top = (e.clientY + 15) + 'px';
        });

        init();
    </script>
</body>
</html>
